zabbix_export:
  version: '7.2'
  template_groups:
    - uuid: fcbabe7d26dd485d9dc15fc17aefdb6f
      name: Templates/Network
  templates:
    - uuid: d77aae52b4fa4c7c97ba371a77cb5a07
      template: 'Aruba Central v1.0'
      name: 'Aruba Central v1.0'
      description: |
        Version: 1.0
        This template covers only the wireless part of Aruba Central monitoring. The template is expecting an always valid access token, which must be updated in some way (API / DB / internal javascript / Zabbix custom mods). A detailed howto will be published about it on Zabbix blog: Aruba Central API monitoring with Zabbix. Feel free to improve / update this template.
      groups:
        - name: Templates/Network
      items:
        - uuid: 008cdc561faf49daa2cc0a83183abeaa
          name: 'Get AP'
          type: HTTP_AGENT
          key: get.ap
          delay: '{$UPDATE_INT}'
          history: 1h
          value_type: TEXT
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
              error_handler: CUSTOM_VALUE
              error_handler_params: no_data
            - type: JSONPATH
              parameters:
                - $.aps
          url: '{$BASE_URL}/monitoring/v2/aps'
          query_fields:
            - name: limit
              value: '{$RESULT_LIMIT}'
            - name: calculate_client_count
              value: 'true'
            - name: show_resource_details
              value: 'true'
          http_proxy: '{$WEB_PROXY}'
          headers:
            - name: accept
              value: application/json
            - name: authorization
              value: 'Bearer {$ACCESS_TOKEN}'
          tags:
            - tag: scope
              value: raw_data
          triggers:
            - uuid: 63ba647310474ba9b1db28c44ba79559
              expression: 'find(/Aruba Central v1.0/get.ap,,"iregexp","no_data")=1'
              name: 'Get AP - API access is unavailable'
              priority: WARNING
              description: 'The API access is unavailable. The most likely problem is wrong/missing access token.'
              manual_close: 'YES'
        - uuid: eb4376358a9848488edf6fcb0590a99d
          name: 'Get gateway'
          type: HTTP_AGENT
          key: get.gateway
          delay: '{$UPDATE_INT}'
          history: 1h
          value_type: TEXT
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
              error_handler: CUSTOM_VALUE
              error_handler_params: no_data
            - type: JSONPATH
              parameters:
                - $.gateways
          url: '{$BASE_URL}/monitoring/v1/gateways'
          query_fields:
            - name: limit
              value: '{$RESULT_LIMIT}'
          http_proxy: '{$WEB_PROXY}'
          headers:
            - name: accept
              value: application/json
            - name: authorization
              value: 'Bearer {$ACCESS_TOKEN}'
          tags:
            - tag: scope
              value: raw_data
          triggers:
            - uuid: ec76fc131646450585d6358ecc55b835
              expression: 'find(/Aruba Central v1.0/get.gateway,,"iregexp","no_data")=1'
              name: 'Get gateway - API access is unavailable'
              priority: WARNING
              description: 'The API access is unavailable. The most likely problem is wrong/missing access token.'
              manual_close: 'YES'
        - uuid: 179069328a4547578842d09a7a88e52c
          name: 'Get site health'
          type: HTTP_AGENT
          key: get.site_health
          delay: '{$UPDATE_INT}'
          history: 1h
          value_type: TEXT
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - '-1'
              error_handler: CUSTOM_VALUE
              error_handler_params: no_data
            - type: JSONPATH
              parameters:
                - $.items
          url: '{$BASE_URL}/branchhealth/v1/site'
          query_fields:
            - name: limit
              value: '{$RESULT_LIMIT}'
          http_proxy: '{$WEB_PROXY}'
          headers:
            - name: accept
              value: application/json
            - name: authorization
              value: 'Bearer {$ACCESS_TOKEN}'
          tags:
            - tag: scope
              value: raw_data
          triggers:
            - uuid: e873d6ccf2d04150a52fa5c45a3129b3
              expression: 'find(/Aruba Central v1.0/get.site_health,,"iregexp","no_data")=1'
              name: 'Get branch health - API access is unavailable'
              priority: WARNING
              description: 'The API access is unavailable. The most likely problem is wrong/missing access token.'
              manual_close: 'YES'
      discovery_rules:
        - uuid: 726a040175a54ebca039629798a944aa
          name: AP
          type: DEPENDENT
          key: discovery.ap
          filter:
            conditions:
              - macro: '{#AP_SITE}'
                value: 'null'
                operator: NOT_MATCHES_REGEX
          lifetime: '{$KEEP_LOST_RESOURCES}'
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: 03c9c194e6204dcb8a4441c0f1f1c687
              name: 'Client count [ {#AP_NAME} ]'
              type: DEPENDENT
              key: 'ap.client_count[{#AP_NAME}]'
              history: '{$HISTORY_SHORT}'
              trends: '{$TREND_STD}'
              description: |
                Site name: {#AP_SITE}
                AP name: {#AP_NAME}
                Model: {#AP_MODEL}
                Serial number: {#AP_SN}
                MAC: {#AP_MAC}
                IP address: {#AP_IP}
                Group: {#AP_GROUP}
                Firmware: {#AP_FW}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#AP_SN}'')].client_count.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: get.ap
              tags:
                - tag: ap
                  value: client_count
                - tag: scope
                  value: ap
                - tag: site
                  value: '{#AP_SITE}'
            - uuid: 4e579dc0b2804f9094579c512a57c33e
              name: 'CPU utilization [ {#AP_NAME} ]'
              type: DEPENDENT
              key: 'ap.cpu_utilization[{#AP_NAME}]'
              history: '{$HISTORY_MIN}'
              trends: '{$TREND_STD}'
              units: '%'
              description: |
                Site name: {#AP_SITE}
                AP name: {#AP_NAME}
                Model: {#AP_MODEL}
                Serial number: {#AP_SN}
                MAC: {#AP_MAC}
                IP address: {#AP_IP}
                Group: {#AP_GROUP}
                Firmware: {#AP_FW}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#AP_SN}'')].cpu_utilization.first()'
              master_item:
                key: get.ap
              tags:
                - tag: ap
                  value: cpu
                - tag: scope
                  value: ap
                - tag: site
                  value: '{#AP_SITE}'
              trigger_prototypes:
                - uuid: eb71a5aaf43b4f79ad07a7caea7fdd2d
                  expression: 'avg(/Aruba Central v1.0/ap.cpu_utilization[{#AP_NAME}],1h)>={$CPU_WARN}'
                  name: 'Access point [ {#AP_NAME} ] CPU utilization is high'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: name
                      value: '{#AP_NAME}'
            - uuid: 5e12dfd4b6414ed9b682eaec14037e0d
              name: 'Status [ {#AP_NAME} ]'
              type: DEPENDENT
              key: 'ap.status[{#AP_NAME}]'
              history: '{$HISTORY_MIN}'
              value_type: CHAR
              description: |
                Site name: {#AP_SITE}
                AP name: {#AP_NAME}
                Model: {#AP_MODEL}
                Serial number: {#AP_SN}
                MAC: {#AP_MAC}
                IP address: {#AP_IP}
                Group: {#AP_GROUP}
                Firmware: {#AP_FW}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#AP_SN}'')].status.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.ap
              tags:
                - tag: ap
                  value: status
                - tag: scope
                  value: ap
                - tag: site
                  value: '{#AP_SITE}'
              trigger_prototypes:
                - uuid: 482ab3b9ea1444739f520e2f999685cd
                  expression: 'in(last(/Aruba Central v1.0/ap.status[{#AP_NAME}]),"Up")=0'
                  name: 'Access point [ {#AP_NAME} ] is unavailable'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Site name: {#AP_SITE}
                    AP name: {#AP_NAME}
                    Model: {#AP_MODEL}
                    Serial number: {#AP_SN}
                    MAC: {#AP_MAC}
                    IP address: {#AP_IP}
                    Group: {#AP_GROUP}
                  manual_close: 'YES'
                  tags:
                    - tag: name
                      value: '{#AP_NAME}'
            - uuid: 7c044e94c2884e69b03c44a1b7be99aa
              name: 'Uptime [ {#AP_NAME} ]'
              type: DEPENDENT
              key: 'ap.uptime[{#AP_NAME}]'
              history: '{$HISTORY_MIN}'
              trends: '0'
              units: uptime
              description: |
                Site name: {#AP_SITE}
                AP name: {#AP_NAME}
                Model: {#AP_MODEL}
                Serial number: {#AP_SN}
                MAC: {#AP_MAC}
                IP address: {#AP_IP}
                Group: {#AP_GROUP}
                Firmware: {#AP_FW}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#AP_SN}'')].uptime.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.ap
              tags:
                - tag: ap
                  value: uptime
                - tag: scope
                  value: ap
                - tag: site
                  value: '{#AP_SITE}'
              trigger_prototypes:
                - uuid: 2f6fb9d824654fb5b9e9b052164de2f8
                  expression: 'last(/Aruba Central v1.0/ap.uptime[{#AP_NAME}])>0 and last(/Aruba Central v1.0/ap.uptime[{#AP_NAME}])<10m'
                  name: 'Access point [ {#AP_NAME} ] has been restarted'
                  priority: INFO
                  description: |
                    Site name: {#AP_SITE}
                    AP name: {#AP_NAME}
                    Model: {#AP_MODEL}
                    Serial number: {#AP_SN}
                    MAC: {#AP_MAC}
                    IP address: {#AP_IP}
                    Group: {#AP_GROUP}
                  manual_close: 'YES'
                  tags:
                    - tag: name
                      value: '{#AP_NAME}'
          master_item:
            key: get.ap
          lld_macro_paths:
            - lld_macro: '{#AP_FW}'
              path: $.firmware_version
            - lld_macro: '{#AP_GROUP}'
              path: $.group_name
            - lld_macro: '{#AP_IP}'
              path: $.ip_address
            - lld_macro: '{#AP_MAC}'
              path: $.macaddr
            - lld_macro: '{#AP_MODEL}'
              path: $.model
            - lld_macro: '{#AP_NAME}'
              path: $.name
            - lld_macro: '{#AP_SITE}'
              path: $.site
            - lld_macro: '{#AP_SN}'
              path: $.serial
        - uuid: 60a02c625ad74418ba35710eca31df0d
          name: Gateway
          type: DEPENDENT
          key: discovery.gateway
          lifetime: '{$KEEP_LOST_RESOURCES}'
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: b55a103addb84025bdf21ceef54a9d79
              name: 'CPU utilization [ {#GW_NAME} ]'
              type: DEPENDENT
              key: 'gateway.cpu_util[{#GW_NAME}]'
              history: '{$HISTORY_SHORT}'
              trends: '{$TREND_STD}'
              units: '%'
              description: |
                Site name: {#GW_SITE}
                Gateway name: {#GW_NAME}
                Model: {#GW_MODEL}
                Serial number: {#GW_SN}
                MAC: {#GW_MAC}
                IP address: {#GW_IP}
                Group: {#GW_GROUP}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#GW_SN}'')].cpu_utilization.first()'
              master_item:
                key: get.gateway
              tags:
                - tag: gateway
                  value: cpu
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
              trigger_prototypes:
                - uuid: a8f486db314b409490778711819f29ff
                  expression: 'avg(/Aruba Central v1.0/gateway.cpu_util[{#GW_NAME}],1h)>={$CPU_WARN}'
                  name: 'Aruba gateway [ {#GW_NAME} ] CPU utilization is high'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Site name: {#GW_SITE}
                    Gateway name: {#GW_NAME}
                    Model: {#GW_MODEL}
                    Serial number: {#GW_SN}
                    MAC: {#GW_MAC}
                    IP address: {#GW_IP}
                    Group: {#GW_GROUP}
                  manual_close: 'YES'
                  tags:
                    - tag: name
                      value: '{#GW_NAME}'
            - uuid: 59d7a08aa6374ec490da376fe31f95db
              name: 'Firmware version [ {#GW_NAME} ]'
              type: DEPENDENT
              key: 'gateway.firmware_version[{#GW_NAME}]'
              history: '{$HISTORY_MIN}'
              value_type: CHAR
              description: |
                Site name: {#GW_SITE}
                Gateway name: {#GW_NAME}
                Model: {#GW_MODEL}
                Serial number: {#GW_SN}
                MAC: {#GW_MAC}
                IP address: {#GW_IP}
                Group: {#GW_GROUP}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#GW_SN}'')].firmware_version.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.gateway
              tags:
                - tag: gateway
                  value: firmware
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
            - uuid: 2d6b1baafb71465e9b0a3b63f2d7fee5
              name: 'Memory usage [ {#GW_NAME} ]'
              type: CALCULATED
              key: 'gateway.memory_usage[{#GW_NAME}]'
              delay: '{$UPDATE_INT}'
              history: '{$HISTORY_SHORT}'
              value_type: FLOAT
              trends: '0'
              units: '%'
              params: '100-((last(//gateway.mem_free[{#GW_NAME}])/last(//gateway.mem_total[{#GW_NAME}]))*100)'
              preprocessing:
                - type: REGEX
                  parameters:
                    - '^(\d*).*'
                    - \1
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: gateway
                  value: memory
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
              trigger_prototypes:
                - uuid: 822ef722ae57483baae56adae237bb99
                  expression: 'avg(/Aruba Central v1.0/gateway.memory_usage[{#GW_NAME}],1h)>={$MEMORY_WARN}'
                  name: 'Aruba gateway [ {#GW_NAME} ] Memory utilization is high'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Site name: {#GW_SITE}
                    Gateway name: {#GW_NAME}
                    Model: {#GW_MODEL}
                    Serial number: {#GW_SN}
                    MAC: {#GW_MAC}
                    IP address: {#GW_IP}
                    Group: {#GW_GROUP}
                  manual_close: 'YES'
                  tags:
                    - tag: name
                      value: '{#GW_NAME}'
            - uuid: 872d0845fd364cc5b814f411dba3b34f
              name: 'Memory free [ {#GW_NAME} ]'
              type: DEPENDENT
              key: 'gateway.mem_free[{#GW_NAME}]'
              history: '{$HISTORY_SHORT}'
              trends: '{$TREND_STD}'
              units: B
              description: |
                Site name: {#GW_SITE}
                Gateway name: {#GW_NAME}
                Model: {#GW_MODEL}
                Serial number: {#GW_SN}
                MAC: {#GW_MAC}
                IP address: {#GW_IP}
                Group: {#GW_GROUP}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#GW_SN}'')].mem_free.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.gateway
              tags:
                - tag: gateway
                  value: memory
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
            - uuid: 78e7b8a80534414da87519a8ded5510d
              name: 'Memory total [ {#GW_NAME} ]'
              type: DEPENDENT
              key: 'gateway.mem_total[{#GW_NAME}]'
              history: '{$HISTORY_SHORT}'
              trends: '{$TREND_STD}'
              units: B
              description: |
                Site name: {#GW_SITE}
                Gateway name: {#GW_NAME}
                Model: {#GW_MODEL}
                Serial number: {#GW_SN}
                MAC: {#GW_MAC}
                IP address: {#GW_IP}
                Group: {#GW_GROUP}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#GW_SN}'')].mem_total.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.gateway
              tags:
                - tag: gateway
                  value: memory
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
            - uuid: e0a9d4bb5dfd40cab74d7ff6a2b0ad6f
              name: 'Last reboot reason [ {#GW_NAME} ]'
              type: DEPENDENT
              key: 'gateway.reboot_reason[{#GW_NAME}]'
              history: '{$HISTORY_MIN}'
              value_type: CHAR
              description: |
                Site name: {#GW_SITE}
                Gateway name: {#GW_NAME}
                Model: {#GW_MODEL}
                Serial number: {#GW_SN}
                MAC: {#GW_MAC}
                IP address: {#GW_IP}
                Group: {#GW_GROUP}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#GW_SN}'')].reboot_reason.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.gateway
              tags:
                - tag: gateway
                  value: reboot
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
            - uuid: 9c4110d0024041cb9502d312a8605baf
              name: 'Status [ {#GW_NAME} ]'
              type: DEPENDENT
              key: 'gateway.status[{#GW_NAME}]'
              history: '{$HISTORY_MIN}'
              value_type: CHAR
              description: |
                Site name: {#GW_SITE}
                Gateway name: {#GW_NAME}
                Model: {#GW_MODEL}
                Serial number: {#GW_SN}
                MAC: {#GW_MAC}
                IP address: {#GW_IP}
                Group: {#GW_GROUP}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#GW_SN}'')].status.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.gateway
              tags:
                - tag: gateway
                  value: status
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
              trigger_prototypes:
                - uuid: a7911aebd9e44f4cbbb43fa94ccd1026
                  expression: 'in(last(/Aruba Central v1.0/gateway.status[{#GW_NAME}]),"Up")=0'
                  name: 'Aruba gateway [ {#GW_NAME} ] is unavailable'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    Site name: {#GW_SITE}
                    Gateway name: {#GW_NAME}
                    Model: {#GW_MODEL}
                    Serial number: {#GW_SN}
                    MAC: {#GW_MAC}
                    IP address: {#GW_IP}
                    Group: {#GW_GROUP}
                  manual_close: 'YES'
                  tags:
                    - tag: name
                      value: '{#GW_NAME}'
            - uuid: 09e552ff63704cb792e0e3cce3d95985
              name: 'Uptime [ {#GW_NAME} ]'
              type: DEPENDENT
              key: 'gateway.uptime[{#GW_NAME}]'
              history: '{$HISTORY_MIN}'
              trends: '0'
              units: uptime
              description: |
                Site name: {#GW_SITE}
                Gateway name: {#GW_NAME}
                Model: {#GW_MODEL}
                Serial number: {#GW_SN}
                MAC: {#GW_MAC}
                IP address: {#GW_IP}
                Group: {#GW_GROUP}
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.serial==''{#GW_SN}'')].uptime.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.gateway
              tags:
                - tag: gateway
                  value: uptime
                - tag: scope
                  value: gateway
                - tag: site
                  value: '{#GW_SITE}'
              trigger_prototypes:
                - uuid: 1604148a874a4841ac03153932526573
                  expression: 'last(/Aruba Central v1.0/gateway.uptime[{#GW_NAME}])>0 and last(/Aruba Central v1.0/gateway.uptime[{#GW_NAME}])<10m'
                  name: 'Aruba gateway [ {#GW_NAME} ] has been restarted'
                  priority: INFO
                  description: |
                    Site name: {#GW_SITE}
                    Gateway name: {#GW_NAME}
                    Model: {#GW_MODEL}
                    Serial number: {#GW_SN}
                    MAC: {#GW_MAC}
                    IP address: {#GW_IP}
                    Group: {#GW_GROUP}
                  tags:
                    - tag: name
                      value: '{#GW_NAME}'
          master_item:
            key: get.gateway
          lld_macro_paths:
            - lld_macro: '{#GW_GROUP}'
              path: $.group_name
            - lld_macro: '{#GW_IP}'
              path: $.ip_address
            - lld_macro: '{#GW_MAC}'
              path: $.macaddr
            - lld_macro: '{#GW_MODEL}'
              path: $.model
            - lld_macro: '{#GW_NAME}'
              path: $.name
            - lld_macro: '{#GW_SITE}'
              path: $.site
            - lld_macro: '{#GW_SN}'
              path: $.serial
        - uuid: f700022b35ad4b3885f26b04702db8c9
          name: 'Site health'
          type: DEPENDENT
          key: discovery.site_health
          filter:
            conditions:
              - macro: '{#SITE_NAME}'
                value: Kazakhstan
                operator: NOT_MATCHES_REGEX
          lifetime: '{$KEEP_LOST_RESOURCES}'
          enabled_lifetime_type: DISABLE_NEVER
          item_prototypes:
            - uuid: 05652cfd5f4e4c4c83b45d0633d1e646
              name: '{#SITE_NAME} - Gateways offline'
              type: DEPENDENT
              key: 'site_health.branch_device_status_down[{#SITE_ID}]'
              history: '{$HISTORY_MIN}'
              trends: '{$TREND_STD}'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id==''{#SITE_ID}'')].branch_device_status_down.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.site_health
              tags:
                - tag: scope
                  value: site_health
                - tag: site_health
                  value: gateway
            - uuid: b50b629479704175aa94ad0a69e91b50
              name: '{#SITE_NAME} - Gateways online'
              type: DEPENDENT
              key: 'site_health.branch_device_status_up[{#SITE_ID}]'
              history: '{$HISTORY_MIN}'
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id==''{#SITE_ID}'')].branch_device_status_up.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.site_health
              tags:
                - tag: scope
                  value: site_health
                - tag: site_health
                  value: gateway
              trigger_prototypes:
                - uuid: df5ba58dcdd54adf9f55747f47f74218
                  expression: 'last(/Aruba Central v1.0/site_health.branch_device_status_up[{#SITE_ID}])=0'
                  name: '{#SITE_NAME} - Both Aruba gateways are down'
                  priority: HIGH
                  manual_close: 'YES'
                  tags:
                    - tag: site
                      value: '{#SITE_NAME}'
            - uuid: 90a4ae35819e47a09b11a1af02df4eac
              name: '{#SITE_NAME} - Connection count'
              type: DEPENDENT
              key: 'site_health.connection_count[{#SITE_ID}]'
              history: '{$HISTORY_SHORT}'
              trends: '{$TREND_STD}'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id==''{#SITE_ID}'')].connected_count.first()'
              master_item:
                key: get.site_health
              tags:
                - tag: scope
                  value: site_health
                - tag: site_health
                  value: connection
            - uuid: 17dda4ea5c4e421a8f3871b69d3c7950
              name: '{#SITE_NAME} - APs offline'
              type: DEPENDENT
              key: 'site_health.device_down[{#SITE_ID}]'
              history: '{$HISTORY_STD}'
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id==''{#SITE_ID}'')].device_down.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.site_health
              tags:
                - tag: scope
                  value: site_health
                - tag: site_health
                  value: ap
            - uuid: 8ae267f6e2d44803923a4fe392ca965a
              name: '{#SITE_NAME} - APs online'
              type: DEPENDENT
              key: 'site_health.device_up[{#SITE_ID}]'
              history: '{$HISTORY_STD}'
              trends: '0'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id==''{#SITE_ID}'')].device_up.first()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.site_health
              tags:
                - tag: scope
                  value: site_health
                - tag: site_health
                  value: ap
              trigger_prototypes:
                - uuid: 19f4e5f7632848afba5d6c274ac99acd
                  expression: 'last(/Aruba Central v1.0/site_health.device_up[{#SITE_ID}])=0'
                  name: '{#SITE_NAME} - All Aruba access points are unavailable'
                  opdata: 'Available APs: {ITEM.LASTVALUE1}'
                  priority: HIGH
                  manual_close: 'YES'
                  tags:
                    - tag: site
                      value: '{#SITE_NAME}'
            - uuid: 1fe1f7bc4651478fb4dd4c4258d08ca1
              name: '{#SITE_NAME} - Potential issue'
              type: DEPENDENT
              key: 'site_health.potential_issue[{#SITE_ID}]'
              history: '{$HISTORY_MIN}'
              trends: '0'
              valuemap:
                name: potential_issue
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id==''{#SITE_ID}'')].potential_issue.first()'
                - type: STR_REPLACE
                  parameters:
                    - 'false'
                    - '0'
                - type: STR_REPLACE
                  parameters:
                    - 'true'
                    - '1'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1d
              master_item:
                key: get.site_health
              tags:
                - tag: scope
                  value: site_health
                - tag: site_health
                  value: issue
              trigger_prototypes:
                - uuid: 0096c65e04d24a40a349966bea06e37b
                  expression: 'last(/Aruba Central v1.0/site_health.potential_issue[{#SITE_ID}])=1'
                  name: '{#SITE_NAME} - Potential issues are present'
                  status: DISABLED
                  discover: NO_DISCOVER
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: site
                      value: '{#SITE_NAME}'
          master_item:
            key: get.site_health
          lld_macro_paths:
            - lld_macro: '{#SITE_ID}'
              path: $.id
            - lld_macro: '{#SITE_NAME}'
              path: $.name
      macros:
        - macro: '{$ACCESS_TOKEN}'
          value: tbd
          description: 'define it on the host level'
        - macro: '{$BASE_URL}'
          value: tbd
          description: 'define it on the host level'
        - macro: '{$CPU_WARN}'
          value: '75'
          description: 'Warning threshold for CPU'
        - macro: '{$HISTORY_MIN}'
          value: 25h
        - macro: '{$HISTORY_SHORT}'
          value: 7d
        - macro: '{$HISTORY_STD}'
          value: 21d
        - macro: '{$MEMORY_WARN}'
          value: '75'
          description: 'Warning threshold for memory'
        - macro: '{$RESULT_LIMIT}'
          value: '1000'
          description: 'Aruba API pagination limit. Default is 100 and max is 1000.'
        - macro: '{$TREND_STD}'
          value: 550d
        - macro: '{$UPDATE_INT}'
          value: 5m
          description: 'Frequency of updates / api calls'
        - macro: '{$WEB_PROXY}'
          value: 'proxyserver:port'
          description: 'your forward proxy address and port'
      valuemaps:
        - uuid: 594b8e5e94f04b55bd7d8f6008d2d42f
          name: potential_issue
          mappings:
            - value: '0'
              newvalue: 'false'
            - value: '1'
              newvalue: 'true'
